---
  tasks:
  - name: install Active Directory services
    win_feature:
      name: AD-Domain-Services
      include_management_tools: yes
      include_sub_features: yes
      state: present

  - name: configure as Domain Controller
    win_domain_controller:
      dns_domain_name:  "{{ domain_name }}"
      domain_admin_user: "{{ domain_user }}"
      domain_admin_password: "{{ domain_pw }}"
      safe_mode_password: "{{ safe_pw }}"
      state: domain_controller
      log_path: c:\ansible_win_domain_controller.txt

  - name: Reboot promoted domain controller
    raw: shutdown /r
    when: result|changed
    async: 0
    poll: 0
    ignore_errors: true
